---
title: "PM25 and Confounder County Correlations"
author: "Sophie Woodward"
date: '2023-04-05'
output: pdf_document
---

```{r}
library(ggplot2)
```

```{r}
study = read.csv('Study_dataset_2010.csv')
summary(study)
studysub = study[,c(2,4,5,6,7,8,9,10,11,12,14,16,17:37)]
summary(studysub)
partialcors = rep(NA, ncol(studysub)-1)
for (i in 2:ncol(studysub)){
  print(names(studysub)[i])
  predictors = names(studysub)[-c(1,i)] 
  formula1 = paste("qd_mean_pm25 ~ ", paste0(predictors, collapse = " + "))
  mm1 = lm(formula = formula1, data = studysub)
  res1 = mm1$residuals
  predictors = names(studysub)[-c(1,i)] 
  formula2 = paste(names(studysub)[i], "~", paste0(predictors, collapse = " + "))
  mm2 = lm(formula = formula2, data = studysub)
  res2 = mm2$residuals
  partialcors[i-1] = cor(res1, res2)
}


# Plot Partial Correlations

order = order(abs(partialcors))
balance = data.frame(matrix(NA, nrow = ncol(studysub)-1, ncol = 0))
balance$Covariates = rep(1:(ncol(studysub)-1), 1)
balance$Correlation = c(sort(abs(partialcors)))
balance$covariates_name = rep((names(studysub)[-1])[order], 1)

p1 = ggplot(balance, aes(x=Correlation, y=Covariates)) + 
  scale_y_discrete(limit = 1:(ncol(studysub)-1),
                   labels = (names(studysub)[-1])[order]) + 
  geom_point() +
  geom_path() +
  geom_vline(xintercept = 0.1) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 10), legend.position = c(0.7, 0.2),
        axis.text.y = element_text(angle = 20, hjust = 1)) +
  ggtitle("PM2.5 and Confounders at County Level: Synthetic Dataset") + 
  xlab("Absolute Partial Correlation")

p1
```

